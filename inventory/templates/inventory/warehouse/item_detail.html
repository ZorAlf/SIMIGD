{% extends 'inventory/base.html' %}

{% block title %}Detail Barang - SIMIGD{% endblock %}

{% block page_title %}Detail Barang{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- Item Information -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-box-seam me-2"></i>Informasi Barang
                </h5>
                <div class="d-flex gap-2">
                    <!-- <a href="{% url 'item_update' object.items_id %}" class="btn btn-warning btn-sm">
                        <i class="bi bi-pencil me-1"></i>Edit
                    </a>
                    <a href="{% url 'item_delete' object.items_id %}" class="btn btn-danger btn-sm">
                        <i class="bi bi-trash me-1"></i>Hapus
                    </a> -->
                </div>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-upc me-2"></i>Kode Barang:</strong>
                    </div>
                    <div class="col-md-8">
                        <span class="badge bg-secondary fs-6">{{ object.code }}</span>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-box me-2"></i>Nama Barang:</strong>
                    </div>
                    <div class="col-md-8">
                        <h5 class="mb-0">{{ object.name }}</h5>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-folder me-2"></i>Kategori:</strong>
                    </div>
                    <div class="col-md-8">
                        {% if object.category %}
                            <span class="badge bg-info">{{ object.category.name }}</span>
                        {% else %}
                            -
                        {% endif %}
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-rulers me-2"></i>Satuan:</strong>
                    </div>
                    <div class="col-md-8">
                        {{ object.get_unit_display }}
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-file-text me-2"></i>Deskripsi:</strong>
                    </div>
                    <div class="col-md-8">
                        {{ object.description|default:"-"|linebreaksbr }}
                    </div>
                </div>
                
                <hr>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-boxes me-2"></i>Stok Saat Ini:</strong>
                    </div>
                    <div class="col-md-8">
                        <h4 class="mb-0">
                            <span class="badge {% if object.current_stock <= object.minimum_stock %}bg-danger{% else %}bg-success{% endif %}">
                                {{ object.current_stock }} {{ object.get_unit_display }}
                            </span>
                        </h4>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-exclamation-triangle me-2"></i>Stok Minimum:</strong>
                    </div>
                    <div class="col-md-8">
                        {{ object.minimum_stock }} {{ object.get_unit_display }}
                    </div>
                </div>
                
                {% if object.current_stock <= object.minimum_stock %}
                <div class="alert alert-danger" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>Peringatan!</strong> Stok barang ini sudah mencapai atau di bawah stok minimum. Segera lakukan pengisian stok.
                </div>
                {% endif %}
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-toggle-on me-2"></i>Status:</strong>
                    </div>
                    <div class="col-md-8">
                        {% if object.is_active %}
                            <span class="badge bg-success">Aktif</span>
                        {% else %}
                            <span class="badge bg-secondary">Nonaktif</span>
                        {% endif %}
                    </div>
                </div>
                
                <hr>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-calendar-plus me-2"></i>Dibuat:</strong>
                    </div>
                    <div class="col-md-8">
                        {{ object.created_at|date:"d M Y H:i" }}
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-calendar-check me-2"></i>Terakhir Diubah:</strong>
                    </div>
                    <div class="col-md-8">
                        {{ object.updated_at|date:"d M Y H:i" }}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Transaction History -->
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#incoming" role="tab">
                            <i class="bi bi-arrow-down-circle me-1"></i>Barang Masuk
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#outgoing" role="tab">
                            <i class="bi bi-arrow-up-circle me-1"></i>Barang Keluar
                        </a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- Incoming Tab -->
                    <div class="tab-pane fade show active" id="incoming" role="tabpanel">
                        {% if recent_incoming %}
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>No. Transaksi</th>
                                        <th>Supplier</th>
                                        <th>Jumlah</th>
                                        <th>Diterima Oleh</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for trans in recent_incoming %}
                                    <tr>
                                        <td>{{ trans.transaction_date|date:"d M Y" }}</td>
                                        <td><span class="badge bg-secondary">{{ trans.transaction_number }}</span></td>
                                        <td>{{ trans.supplier.name|default:"-" }}</td>
                                        <td><span class="badge bg-success">+{{ trans.quantity }} {{ object.get_unit_display }}</span></td>
                                        <td>{{ trans.received_by.name|default:"-" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <a href="{% url 'incoming_list' %}?item={{ object.items_id }}" class="btn btn-sm btn-outline-primary">
                                Lihat Semua Transaksi Masuk
                            </a>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">Belum ada transaksi barang masuk.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Outgoing Tab -->
                    <div class="tab-pane fade" id="outgoing" role="tabpanel">
                        {% if recent_outgoing %}
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>No. Transaksi</th>
                                        <th>Tujuan</th>
                                        <th>Jumlah</th>
                                        <th>Dikeluarkan Oleh</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for trans in recent_outgoing %}
                                    <tr>
                                        <td>{{ trans.transaction_date|date:"d M Y" }}</td>
                                        <td><span class="badge bg-secondary">{{ trans.transaction_number }}</span></td>
                                        <td>{{ trans.purpose|default:"-" }}</td>
                                        <td><span class="badge bg-danger">-{{ trans.quantity }} {{ object.get_unit_display }}</span></td>
                                        <td>{{ trans.released_by.name|default:"-" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <a href="{% url 'outgoing_list' %}?item={{ object.items_id }}" class="btn btn-sm btn-outline-primary">
                                Lihat Semua Transaksi Keluar
                            </a>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">Belum ada transaksi barang keluar.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Stock Status -->
        <div class="card mb-4">
            <div class="card-header {% if object.current_stock <= object.minimum_stock %}bg-danger{% else %}bg-success{% endif %} text-white">
                <h6 class="mb-0">
                    <i class="bi bi-speedometer2 me-2"></i>Status Stok
                </h6>
            </div>
            <div class="card-body text-center">
                <h1 class="display-4 mb-0">{{ object.current_stock }}</h1>
                <p class="text-muted mb-3">{{ object.get_unit_display }}</p>
                
                <small class="text-muted">
                    Minimum: {{ object.minimum_stock }} {{ object.get_unit_display }}
                </small>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="bi bi-lightning-charge me-2"></i>Aksi Cepat
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'incoming_create' %}" class="btn btn-success">
                        <i class="bi bi-arrow-down-circle me-1"></i>Tambah Barang Masuk
                    </a>
                    <a href="{% url 'outgoing_create' %}" class="btn btn-danger">
                        <i class="bi bi-arrow-up-circle me-1"></i>Tambah Barang Keluar
                    </a>
                    <a href="{% url 'item_update' object.items_id %}" class="btn btn-warning">
                        <i class="bi bi-pencil me-1"></i>Edit Barang
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'item_list' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left me-1"></i>Kembali ke Daftar
    </a>
</div>
{% endblock %}
